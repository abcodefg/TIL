# 데이터 링크 계층: 랜에서 데이터 전송하기



## 데이터 링크 계층의 역할과 이더넷

* 랜에서 데이터를 주고받으려면 OSI 모델 중 데이터 링크 계층의 기술이 필요하다.

* **데이터 링크 계층**은 **네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층**이며, 그 규칙들 중 가장 많이 사용되는 규칙이 **이더넷(ethernet)**이다.

  * **데이터 링크 계층**의 기술만으로는 **같은 네트워크에 있는 컴퓨터끼리만 통신**이 가능하며, 인터넷이나 **다른 네트워크에 있는 목적지로 데이터를 전달**하려면 **네트워크 계층**의 기술이 필요하다.

* 이더넷은 컴퓨터 여러 대가 동시에 데이터를 전송해도 데이터가 **충돌(collision)**하지 않도록 데이터를 보내는 시점을 늦추는데, 이 방법을 **CSMA/CD(Carrier Sense Multiple Access with Collision Detection)**라고 한다.

  * **캐리어(Carrier)**는 네트워크 상에 나타나는 신호를 의미한다.

  * **다중 접근(Multiple Access)**은 두 pc가 데이터를 동시에 보내는 경우를 의미한다.

  * **CSMA/CD**는 데이터를 보내려고 하는 컴퓨터가 케이블에 데이터가 흐르는지 확인(**CS**)하고, 흐르고 있지 않다면 데이터를 보내며(**MA**), 충돌이 발생하고 있는지 확인한다(**CD**)는 규칙이다.

  * LAN의 통신 프로토콜의 종류 중 하나이다.

    

## MAC 주소의 구조

![What Is A MAC Address And Why You Should Know About It? | by Lakshan  Mamalgaha | Medium](https://miro.medium.com/max/1200/1*FLrfO7JzkOWSBkPBYly37w.png){: width="80%" height="80%"}

* 비트열을 전기신호로 변환하는 랜 카드에는 **MAC(Media Access Control) 주소**가 정해져 있다. 

  * 데이터 링크 계층에서 통신을 위한 네트워크 인터페이스에 할당된 고유 식별자이다.
  * 제조할 때 새겨지기 때문에 **물리 주소**라고도 부르며, **전 세계에서 유일한 번호**이다.

* 48비트 숫자{혹은 6개의 옥텟(octet, 8비트로 구성된 정보단위)}로 구성되어 있으며, 앞의 24비트는 **랜카드의 제조사 번호**, 뒤의 24비트는 **랜카드 자체의 일련번호**이다.

* 데이터 링크 계층에서는 데이터에 이더넷 헤더와 트레일러를 붙인다. 

  * **이더넷 헤더**는 1) **목적지의 MAC 주소**(6바이트 = 48비트), 2) **출발지 MAC 주소**(6바이트), 3) **유형**(2바이트), 총 14바이트로 구성되어 있다.
    * 이 중, **이더넷 유형(Ethernet type)**은 IPv4, IPv6, ARP<sup>[1](#footnote_1)</sup> 등과 같이 이더넷으로 전송되는 **상위 계층의 프로토콜**의 종류를 나타낸다.

  * **트레일러**는 **FCS(Frame Check Sequence)**라고도 하며, **데이터 전송 도중 오류가 발생했는지 확인**하는 용도로 사용한다.
  * 이더넷 헤더와 트레일러가 추가된 데이터를 **프레임(Frame)**이라고 한다.

* 허브를 통해 컴퓨터 A에서 다른 컴퓨터 B로 데이터가 전송되는 과정은 다음과 같다.

  1) A는 여러 계층을 거치며 헤더 혹은 트레일러가 붙은(캡슐화) 데이터를 전기 신호로 변환하여 네트워크로 전송한다.

  2) 허브는 A와 연결된 포트로 수신한 데이터를 다른 모든 포트로 송신한다.

  3) 데이터는 허브에 연결된 다른 모든 컴퓨터에 전송되지만, B를 제외한 다른 컴퓨터에서는 목적지 MAC 주소가 자신의 MAC 주소와 다르므로 **데이터를 파기**하며, B는 역캡슐화 이후 데이터를 수신한다.

     (두 대 이상의 컴퓨터가 데이터를 전송하는 경우에는 충돌을 방지하기 위해 앞서 설명한 CSMA/CD방식이 사용된다.)

## 스위치의 구조

- **스위치(switch)**는 **데이터 링크 계층**에서 동작하고, **레이어 2 스위치** 혹은 **스위칭 허브**라고도 불린다.
  - 외형은 허브와 비슷하지만, 허브와 달리 데이터 충돌이 발생하지 않는다.
- 스위치 내부에는 **MAC 주소 테이블(MAC address table)**이 있다.
  - MAC 주소 테이블에는 스위치의 **포트 번호**와 해당 포트에 연결된 컴퓨터의 **MAC 주소**가 등록되어 있다.
  - 컴퓨터에서 MAC 주소가 추가된 프레임이 전송되면, 스위치는 테이블을 확인하고 출발지 MAC 주소가 등록되어 있지 않으면 이를 포트와 함께 등록(**MAC 주소 학습 기능**)한다.
  - 목적지 MAC 주소가 등록되어 있지 않다면 송신 포트를 제외한 나머지 포트 모두에 데이터를 전송(**플러딩, flooding**)하며, 등록되어 있다면 목적지 컴퓨터에만 데이터를 전송(**MAC 주소 필터링**)한다.

## 데이터가 케이블에서 충돌하지 않는 구조

- 통신 방식에는 **전이중 통신 방식**과 **반이중 통신 방식**이 있다.
  - **전이중 통신 방식**은 데이터의 송수신을 **동시에**하는 방식이며, **반이중 통신 방식**은 회선 하나로 데이터의 송신과 수신을 **번갈아가며** 하는 방식이다.
  - 반이중 통신 방식은 (전이중 통신 방식과 달리) 데이터를 동시에 전송하면 **충돌**이 발생한다.
  - 두 컴퓨터를 직접 랜 케이블로 연결하는 것은 전이중, 허브를 통해 연결하는 것은 반이중 통신 방식에 해당한다.
  - **스위치**는 허브와 달리 충돌이 일어나지 않는 구조로 되어 있어 **전이중 통신 방식**으로도 데이터를 주고받을 수 있다.
    - 반면, 허브는 충돌로 인해 네트워크 지연이 발생하므로, 최근에는 **네트워크로 스위치를 사용하는 것이 표준**이다.
- 네트워크에서 충돌이 발생할 때 영향이 미치는 범위를 **충돌 도메인(collision domain)**이라고 한다.
  - **허브**의 경우 **연결된 모든 컴퓨터가 충돌 도메인**이다.
  - 반면, **스위치**의 경우 전이중 통신 방식이므로 충돌이 일어나지 않고, **충돌 도메인의 범위도 좁다**.
  - 충돌 도메인의 범위가 넓을수록 네트워크가 지연되며 통신 효율이 떨어진다.

![collision domains](https://study-ccna.com/wp-content/images/collision_domains.jpg)

## 이더넷의 종류와 특징

- **이더넷**은 케이블 종류나 통신 속도에 따라 다양한 **규격**으로 분류된다.

- 이더넷의 대표적인 규격은 다음과 같다.

  | 규격 이름  | 통신 속도 | 케이블               | 케이블 최대 길이 | 표준화 연도 |
  | ---------- | --------- | -------------------- | ---------------- | ----------- |
  | 10BASE5    | 10Mbps    | 동축케이블           | 500m             | 1982년      |
  | 10BASE2    | 10Mbps    | 동축케이블           | 185m             | 1988년      |
  | 10BASE-T   | 10Mbps    | UTP케이블(Cat3이상)  | 100m             | 1990년      |
  | 100BASE-TX | 100Mbps   | UTP케이블(Cat5이상)  | 100m             | 1995년      |
  | 1000BASE-T | 1000Mbps  | UTP케이블(Cat5이상)  | 100m             | 1999년      |
  | 10GBASE-T  | 10Gbps    | UTP케이블(Cat6a이상) | 100m             | 2006년      |

- 규격 이름에서 10은 **통신 속도**, BASE는 BASEBAND라는 **전송 방식**, T는 **케이블의 종류**를 나타낸다.

  - **동축케이블**은 하이픈(-) 없이 **케이블의 최대 길이**(예를 들어, 500이면 5), UTP 케이블은 하이픈 뒤에 **케이블의 종류**를 표시한다.

### 주석

<a name="footnote_1">1</a>: ARP(Address Resolution Protocol)는 목적지 컴퓨터의 IP 주소를 이용하여 MAC 주소를 찾기 위한 프로토콜이다. 출발지 컴퓨터가 목적지 컴퓨터의 MAC 주소를 모르면 이를 알아내기 위해 'ARP 요청'을 하며, 지정된 IP 주소를 가진 컴퓨터는 MAC 주소를 응답으로 보내는 'ARP 응답'을 한다. 출발지 컴퓨터에서는 이를 기반으로 이더넷 프레임을 만들 수 있다.

​	출발지 컴퓨터에서는 MAC 주소와 IP 주소의 매핑 정보(**ARP 테이블**)를 메모리에 보관하며, 보존 기간을 ARP 캐시로 지정해 일정 기간이 지나면 삭제하고 다시 ARP 요청을 한다.

### 참고

-네트워크 계층과 데이터 링크 계층의 데이터 전송

https://almotjalal.tistory.com/93

-CSMA/CD란?

https://security-nanglam.tistory.com/193

-이더넷 프로토콜 타입

http://www.ktword.co.kr/test/view/view.php?m_temp1=2039&id=852