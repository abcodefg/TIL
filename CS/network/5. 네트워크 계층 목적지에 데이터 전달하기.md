# 네트워크 계층: 목적지에 데이터 전달하기

## 네트워크 계층의 역할

- **네트워크 계층**은 다른 네트워크에 있는 목적지로 데이터를 전달하기 위해 필요하다.
  - **데이터 링크 계층**에서는 **이더넷 규칙**을 기반으로 **같은 네트워크**에 있는 컴퓨터로는 데이터를 전송할 수 있으나, 인터넷이나 다른 네트워크로는 전송할 수 없다.
- 네트워크 계층을 통해 다른 네트워크로 데이터를 전송하기 위해서는 **목적지까지 어떤 경로로 가는 것이 좋은지**를 알려주는 **라우터(router)**라는 네트워크 장비가 필요하다.
- 랜의 MAC 주소와 같이, 네트워크에서 데이터를 보내려면 **어떤 네트워크의 어떤 컴퓨터인지**를 구분할 수 있는 **IP 주소**로 목적지를 지정해야 한다.
  - **IP(Internet Protocol)**는 네트워크 계층의 프로토콜이다.
  - 네트워크 계층에서는 캡슐화할 때 데이터에 **IP 헤더**를 붙여 **IP 패킷**을 만든다.
    - IP 헤더에는 **출발지 IP 주소**, **목적지 IP 주소**와 같이 데이터를 정확하게 전달하기 위해 필요한 정보가 담겨 있다.
- 또한, 라우터를 통해 목적지 IP 주소까지 어떤 경로로 데이터를 보낼지 결정(**라우팅, routing**)한다.
  - 라우터에는 **라우팅 테이블(routing table)**이 있어 경로 정보를 등록, 관리한다.

## IP 주소의 구조

- IP 주소는 **인터넷 서비스 제공자(ISP)**에게 받을 수 있다.
- IP 주소는 버전에 따라 **IPv4**와 **IPv6**가 있다.
  - **IPv4**는 **32비트**로 되어 있어 IP 주소를 **43억 개** 만들 수  있는데, 인터넷이 널리 보급되며 주소가 부족해지면서 점차 **IPv6**를 사용하게 됐다.
  - *이 글에서 IP 주소는 **IPv4 기준**으로 설명된다.*

![The differences between IPv4 and IPv6](https://signal.avg.com/hs-fs/hubfs/Blog_Content/Avg/Signal/AVG%20Signal%20Images/IPv4%20vs.%20IPv6%20addresses%20(Signal)/IPv4-vs-IPv6-EN.png?width=1320&name=IPv4-vs-IPv6-EN.png)

- IP 주소에는 **공인 IP 주소**와 **사설 IP 주소**가 있다.
  - IPv4의 IP 주소 고갈 문제로 인해, 인터넷에 직접 연결되는 컴퓨터나 라우터에 **공인 IP 주소**를 할당하고, 회사나 가정의 랜에 있는 컴퓨터에는 랜의 네트워크 관리자가 사설 IP 주소를 할당하거나 라우터의 **DHCP(Dynamic Host Configuration Protocol)** 기능을 사용해 주소를 자동으로 할당한다.

![Public or Private IP Address - What's the Difference? | AVG](https://signal.avg.com/hs-fs/hubfs/Blog_Content/Avg/Signal/AVG%20Signal%20Images/Public%20vs.%20local%20IP%20addresses%20(Signal)/Public-vs-local-IP-addresses.png?width=1320&name=Public-vs-local-IP-addresses.png)

- IP 주소는 **32비트**로 구분하기 쉽도록 **10진수**로 표기한다.
  - 실제 IP 주소는 32비트의 2진수이지만, 사람이 읽기 쉽도록 **8비트(옥텟, octet)** 단위로 나눈 뒤, 각 옥텟을 10진수로 변환하여 표기한다.
  - 각 옥텟은 8비트는 **00000000 ~ 11111111**, 10진수는 **0 ~ 255**로 숫자의 범위가 정해져 있다.
  - IP주소는 '어떤 네트워크인지'를 나타내는 **네트워크 ID**와 '어느 컴퓨터인지'를 나타내는 **호스트 ID**로 나뉘어 있다.

![IP Addresses Explained. Hello. I want to share information I… | by Bree  Browder | Geek Culture | Medium](https://miro.medium.com/max/1174/0*KJ0Rc-PoDVodacb2)

## IP 주소의 클래스 구조

- IP 주소는 **네트워크 ID**를 크게 만들거나 **호스트 ID**를 작게 만들어 **네트워크 크기**를 조정할 수 있으며, 네트워크 크기는 **클래스(class)**로 구분된다.
- 이 중, **A 클래스** / **B 클래스** / **C 클래스**는 각각 **대규모** / **중형** / **소규모 네트워크**의 주소로 사용되며, **D 클래스**는 **멀티캐스트(multicast)**, **E 클래스**는 **연구 및 특수용도** 주소로 사용된다.

![img](https://cdn.inflearn.com/public/comments/64d912dd-88b7-4503-bb82-b7ea585f93bf/IP%20%EC%A0%95%EB%A6%AC.jpg)

- 각 클래스는 **공인 IP 주소**와 **사설 IP 주소**를 포함하여 다음과 같이 **범위**가 정해져 있다.

  ![IPv4 class](https://blog.kakaocdn.net/dn/bZVUCs/btrcXjUul4b/eu3dSspA3SvIlPxEFiS06k/img.png)

  - 각 클래스의 범위에는 **공인 IP 주소**의 범위와 **사설 IP 주소**의 범위가 나뉘어 있다.

    ![image-20230106181927025](C:\Users\jodic\AppData\Roaming\Typora\typora-user-images\image-20230106181927025.png)

    ![image-20230106182002794](C:\Users\jodic\AppData\Roaming\Typora\typora-user-images\image-20230106182002794.png)

  - 가정의 랜에서는 주로 C 클래스의 사설 IP 주소인 192.168.O.O이 사용된다.

  - **명령 프롬프트(cmd)**의 **ipconfig** 명령어를 통해 자신의 IP 주소를 확인할 수 있다.

​	

## 네트워크 주소와 브로드캐스트 주소의 구조

- IP 주소에는 컴퓨터에 할당할 수 없는 주소인 **네트워크 주소**와 **브로드캐스트 주소**가 있다.
  - **네트워크 주소**는 **호스트 ID**가 10진수로 **0**, 2진수로 **00000000**인 주소이며, **브로드캐스트 주소**는 **호스트 ID**가 10진수로 **255**, 2진수로 **11111111**인 주소이다.
  - **네트워크 주소**는 어떤 **작은 네트워크를 대표하는 주소**이다. 
    - 예를 들어, 192.168.1.1 ~ 192.168.1.6의 IP 주소를 가진 컴퓨터는 192.168.1.0의 네트워크에 있다고 할 수 있다.
  - **브로드캐스트 주소**는 네트워크에 있는 컴퓨터나 장비 모두에 **한 번에 데이터를 전송**하는 데 사용되는 IP 주소이다. 
    - 예를 들어, 192.168.1.266의 브로드캐스트 주소로 데이터를 전송하면 192.168.1.0의 네트워크에 있는 모든 컴퓨터가 데이터를 받는다.

![img](https://velog.velcdn.com/images%2Fminseojo%2Fpost%2Fa4d7bdb2-d67f-4797-bc69-4872533aca4c%2Fimage.png)

## 서브넷의 구조

- **네트워크를 분할하는 것**을 **서브넷팅(subneting)**이라고 하며, **분할된 네트워크**를 **서브넷(subnet)**이라고 한다.

  - 대규모의 네트워크를 **작은 네트워크로 분할**하여 브로드캐스트로 전송되는 패킷의 범위를 좁히면, 네트워크 지연을 감소시키고 IP 주소를 더 효과적으로 사용할 수 있다.

  - 서브넷팅을 통해 기존에 네트워크 ID, 호스트 ID로 구성되어 있던 것이 **네트워크 ID, 서브넷 ID, 호스트 ID**로 나누어진다.

    - 호스트 ID에서 비트를 빌려 서브넷으로 만든다.

    | 네트워크 ID |         호스트 ID          |
    | :---------: | :------------------------: |
    |  00000001   | 00000000 00000000 00000000 |

    | 네트워크 ID | 서브넷 ID   | 호스트 ID       |
    | ----------- | ----------- | --------------- |
    | 00000001    | 00000000 00 | 000000 00000000 |

- 서브넷팅한 IP 주소에서 어디까지가 네트워크 ID이고 어디부터가 호스트 ID인지 판단하기 어려울 때 **네트워크 ID와 호스트 ID를 식별**하기 위한 값인 **서브넷 마스크**라는 값을 사용한다.

  - **서브넷 마스크**는 클래스 별로 다음과 같은 **32 비트**의 값이며, **슬래시**를 사용한 **프리픽스(prefix) 표기법**으로도 나타낼 수 있다.

    | 클래스 명 | 서브넷 마스크                                             | 프리픽스 표기법 |
    | :-------- | --------------------------------------------------------- | :-------------- |
    | A 클래스  | 11111111  00000000  00000000  00000000 (255. 0. 0. 0)     | /8              |
    | B 클래스  | 11111111  11111111  00000000  00000000 (255. 255. 0. 0)   | /16             |
    | C 클래스  | 11111111  11111111  11111111  00000000 (255. 255. 255. 0) | /24             |

  - 예를 들어, 주소가 C 클래스의 네트워크를 서브넷팅한다고 하자.

    - C 클래스는 일반적으로 네트워크 ID가 24비트지만 호스트 ID에서 4비트를 빌려(서브넷 ID) 네트워크 ID를 28비트로 변경한다.
    - 이 때, 서브넷 마스크는 다음과 같이 변한다.

    |             | 서브넷 마스크                                                | 프리픽스 표기법 |
    | ----------- | ------------------------------------------------------------ | --------------- |
    | 서브넷팅 전 | 11111111  11111111  11111111  00000000 (255. 255. 255. 0)    | /24             |
    | 서브넷팅 후 | 11111111  11111111  11111111  1111 0000 (255. 255. 255. 240) | /28             |

    

## 라우터의 구조

- **라우터**는 서로 **다른 네트워크를 연결**하는 데에 사용되며, 라우터가 있으면 **네트워크를 분리**할 수 있다.

  - 반면, **스위치**는 같은 네트워크에 있는 여러 기기들 혹은 여러 랜(LAN)을 연결하며, 스위치만 있는 네트워크에서는 모든 컴퓨터와 스위치가 **동일한 네트워크**에 속한다.

  

![Switch Vs. Router](https://static.javatpoint.com/tutorial/computer-network/images/switch-vs-router5.png)

- 네트워크를 분할한 다음, 한 컴퓨터가 다른 네트워크에 데이터를 전송하기 위해서는 라우터의 IP 주소를 설정해야 한다. 이 주소는 네트워크의 출입구이며, 이를 **기본 게이트웨이(default gateway)**라고 한다.
  - **기본 게이트웨이**란 자신이 소속된 네트워크 이외에 보내려는 패킷을 **어디로 보내면 좋을지에 대한 정보를 갖고 있지 않을 때의 전송처**이다.
  - 기본 게이트웨이 설정은 네트워크 설정의 일부로 수동으로 하는 경우와 DHCP<sup>[1](#footnote_1)</sup>로 자동으로 하는 경우가 있다.
  - 다른 네트워크에 데이터를 전송하기 위해서는 여기에 추가적으로 **라우팅** 기능이 필요하다.
  - 패킷의 라우팅은 라우터가 하는 일이므로, 일반적으로 기본 게이트웨이로 네트워크의 입출력 역할을 하는 라우터를 설정한다.

![Router acting as Default Gateway](http://www.homenethowto.com/wp-content/uploads/default-gateway.jpg)

![img](https://t1.daumcdn.net/cfile/tistory/1471CC4F4FBEDF3F1D)

- 네트워크 간 통신은 **라우팅**을 통해 한 네트워크에서 다른 네트워크로의 최적의 경로를 선택하고 해당 경로를 통해 데이터를 전송하는데, 이러한 **경로** 정보가 등록되어 있는 테이블이 **라우팅 테이블**이다.

  - 라우팅 테이블은 네트워크 관리자가 수동으로 등록하거나 자동으로 등록할 수 있다.

    - **자동** 등록 방식은 **라우터 간에 경로 정보를 교환**하여 라우팅 테이블 정보를 자동으로 수정하며, 이처럼 라우터 간에 라우팅 정보를 교환하기 위한 프로토콜을 **라우팅 프로토콜**이라고 한다.

    - **수동** 등록은 **소규모** 네트워크, **자동** 등록은 **대규모** 네트워크에 적합하다.

      

### 주석

<a name="footnote_1">1</a>: DHCP(Dynamic Host Configuration Protocol)란 호스트의 IP 주소와 각종 TCP/IP 프로토콜 등의 기본 설정을 클라이언트에게 자동으로 제공해주는 프로토콜을 의미한다. DHCP는 네트워크에 사용되는 IP 주소를 DHCP 서버가 중앙집중식으로 관리하는 클라이언트/서버 모델을 사용하게 된다. 클라이언트는 네트워크 부팅 과정에서 DHCP 서버에 IP 주소를 요청하고 이를 얻을 수 있다.

![img](https://t1.daumcdn.net/cfile/tistory/2519193C5715E03427)

### 참고

-라우팅, 기본 게이트웨이란?

https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=hai0416&logNo=221607511806

-DHCP란?

https://jwprogramming.tistory.com/35